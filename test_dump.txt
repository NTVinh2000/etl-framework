,test_function
0,",W_INSERT_DT"
1,",W_UPDATE_DT"
2,",1. SELECT B.DISTRIBUTOR_KEY,C.CUSTOMER_KEY,D.SALES_FORCE_KEY,E.EMPLOYEE_KEY,A.* 
FROM STG.EMB_DETAILVISITPLAN A
	LEFT JOIN DWH.D_DISTRIBUTOR B
	ON B.DISTRIBUTOR_CODE = A.CUSTOMERCODE AND B.BIN_TYPE = 'MAIN_BIN' AND B.LOCATION_TYPE = 'MAIN_LOCATION'
	LEFT JOIN DWH.D_CUSTOMER C
	ON A.SECONDARYCUSTOMERCODE = C.CUSTOMER_CODE
	LEFT JOIN DWH.D_SALES_FORCE D
	ON A.SALESROUTECODE = D.SALES_ROUTE_CODE
	LEFT JOIN STG.NAV_SALES_ROUTE_RELATIONSHIP E1
	ON E1.DISTRIBUTOR_CODE = A.CUSTOMERCODE AND E1.SALES_ROUTE_CODE = A.SALESROUTECODE 
	AND A.VISITDATE BETWEEN E1.START_EFFECTIVE_DATE AND E1.END_EFFECTIVE_DATE
	LEFT JOIN DWH.D_EMPLOYEE E
	ON E1.SALESPERSON_CODE = E.EMPLOYEE_CODE
2. ID AS W_INTEGRATION_ID"
3,",DEFAULT = 'EMB_DETAILVISITPLAN' AS W_SOURCE"
4,",B.DISTRIBUTOR_KEY AS DISTRIBUTOR_KEY"
5,",C.CUSTOMER_KEY AS CUSTOMER_KEY"
6,",D.SALES_FORCE_KEY AS SALES_FORCE_KEY"
7,",E.EMPLOYEE_KEY AS EMPLOYEE_KEY"
8,",VISITDATE AS DATE_KEY"
9,",YEAR(VISITDATE) AS YEAR"
10,",MONTH(VISITDATE) AS MONTH"
11,",BEATPLANCODE AS BEAT_PLAN_CODE"
12,",SUBPLANCODE AS SUB_PLAN_CODE"
13,",SEQUENCE AS SEQUENCE"
14,",REMARK AS REMARK"
15,",IF DELETED = 1 THEN 'Y' ELSE 'N' AS DELETED_FLAG"
16,",W_INSERT_DT"
17,",W_UPDATE_DT"
18,",1. SELECT C.DISTRIBUTOR_KEY, D.CUSTOMER_KEY, E.EMPLOYEE_KEY, F.SALES_FORCE_KEY, G.PRODUCT_KEY,
A.DOCUMENT_NO, A.LINE_NO, B.EXTERNAL_DOCUMENT_NO, B.OFF_ROUTE, B.FROM_EMOBIZ,B.ORDER_NO,
(CASE WHEN B.SALES_TYPE = 0 THEN 'VANSALES' 
	WHEN B.SALES_TYPE = 1 THEN 'PRESALES' 
	WHEN B.SALES_TYPE = 2 THEN 'PRESALESWITHPARTIALSHIP' ELSE 'SAMPLING' END) AS ORDER_TYPE,
B.ORDER_DATE, B.POSTING_DATE, B.DOCUMENT_DATE, A.SHIPMENT_DATE, B.ACTUAL_POSTING_DATE, B.PLAN_DELIVERY_DATE,
A.QUANTITY, A.QUANTITY_BASE, A.UNIT_PRICE, A.LINE_DISCOUNT_AMOUNT, A.AMOUNT, A.AMOUNT_VALUES,
(CASE WHEN A.FREE_ITEM = 0 THEN 'SALES ITEM'
	WHEN A.FREE_ITEM = 1 THEN 'PROMOTION ITEM'
	WHEN A.FREE_ITEM = 2 THEN 'DISPLAY ITEM' ELSE 'LOYALTY ITEM' END) AS ITEM_TYPE
FROM STG.NAV_SALES_INVOICE_LINE A
	LEFT JOIN STG.NAV_SALES_INVOICE_HEADER B
	ON A.DOCUMENT_NO = B.NO AND A.DISTRIBUTOR = B.DISTRIBUTOR
	LEFT JOIN DWH.D_DISTRIBUTOR C
	ON A.DISTRIBUTOR = C.DISTRIBUTOR_CODE AND A.LOCATION_CODE = C.LOCATION_CODE AND A.BIN_CODE = C.BIN_CODE
	LEFT JOIN DWH.D_CUSTOMER D
	ON A.SELL_TO_CUSTOMER_NO = D.CUSTOMER_CODE
	LEFT JOIN DWH.D_EMPLOYEE E
	ON B.SALESPERSON_CODE = E.EMPLOYEE_CODE
	LEFT JOIN DWH.D_SALES_FORCE F
	ON B.SALES_ROUTE_CODE = F.SALES_ROUTE_CODE
	LEFT JOIN DWH.D_PRODUCT G
	ON A.NO = G.PRODUCT_CODE AND A.UNIT_OF_MEASURE_CODE = G.UOM_CODE
2. SALES_INVOICE~DISTRIBUTOR~DOCUMENT_NO~LINE_NO~NO~UNIT_OF_MEASURE_CODE~ITEM_TYPE AS W_INTEGRATION_ID"
19,",DEFAULT = 'NAV_SALES_INVOICE_LINE' AS W_SOURCE"
20,",C.DISTRIBUTOR_KEY AS DISTRIBUTOR_KEY"
21,",D.CUSTOMER_KEY AS CUSTOMER_KEY"
22,",E.EMPLOYEE_KEY AS EMPLOYEE_KEY"
23,",F.SALES_FORCE_KEY AS SALES_FORCE_KEY"
24,",G.PRODUCT_KEY AS PRODUCT_KEY"
25,",POSTING_DATE AS DATE_KEY"
26,",POSTING_DATE AS YEAR"
27,",POSTING_DATE AS MONTH"
28,",DEFAULT = 'SALES_INVOICE' AS TRANSACTION_TYPE"
29,",A.DOCUMENT_NO AS SALES_HEADER_CODE"
30,",A.LINE_NO AS SALES_LINE_CODE"
31,",B.ORDER_NO AS ORDER_CODE"
32,",B.EXTERNAL_DOCUMENT_NO AS EXTERNAL_DOCUMENT_CODE"
33,",ORDER_TYPE AS ORDER_TYPE"
34,",IF B.OFF_ROUTE = 0 THEN 'N' ELSE 'Y' AS OFF_ROUTE_FLAG"
35,",IF B.FROM_EMOBIZ = 0 THEN 'N' ELSE 'Y' AS FROM_EMOBIZ_FLAG"
36,",B.ORDER_DATE AS ORDER_DATE"
37,",B.POSTING_DATE AS POSTING_DATE"
38,",B.ACTUAL_POSTING_DATE AS ACTUAL_POSTING_DATE"
39,",B.DOCUMENT_DATE AS DOCUMENT_DATE"
40,",B.PLAN_DELIVERY_DATE AS PLAN_DELIVEY_DATE"
41,",A.SHIPMENT_DATE AS ACTUAL_DELIVEY_DATE"
42,",ITEM_TYPE AS ITEM_TYPE"
43,",A.QUANTITY AS QUANTITY"
44,",A.QUANTITY_BASE AS QUANTITY_BASE"
45,",A.UNIT_PRICE AS UNIT_PRICE"
46,",= A.UNIT_PRICE * A.QUANTITY AS AMOUNT"
47,",A.LINE_DISCOUNT_AMOUNT AS DISCOUNT_AMOUNT"
48,",A.AMOUNT AS AMOUNT_AFTER_DISCOUNT"
49,",A.AMOUNT_VALUES AS PROMOTION_VALUE_AMOUNT"
50,",W_INSERT_DT"
51,",W_UPDATE_DT"
52,",1. SELECT C.DISTRIBUTOR_KEY, D.CUSTOMER_KEY, E.EMPLOYEE_KEY, F.SALES_FORCE_KEY, G.PRODUCT_KEY,
	A.DOCUMENT_NO, A.LINE_NO, B.EXTERNAL_DOCUMENT_NO, B.OFF_ROUTE, B.FROM_EMOBIZ,B.ORDER_NO, B.RETURN_ORDER_NO,
	(CASE WHEN B.SALES_TYPE = 0 THEN 'VANSALES' 
		WHEN B.SALES_TYPE = 1 THEN 'PRESALES' 
		WHEN B.SALES_TYPE = 2 THEN 'PRESALESWITHPARTIALSHIP' ELSE 'SAMPLING' END) AS ORDER_TYPE,
	(CASE WHEN B.RETURN_TYPE = 0 THEN 'RETURNNOINVOICE' 
		WHEN B.RETURN_TYPE = 1 THEN 'PARTITALRETURN' ELSE 'COMPLETEDRETURN' END) AS RETURN_TYPE,
	B.ORDER_DATE, B.POSTING_DATE, B.DOCUMENT_DATE,A.SHIPMENT_DATE, B.ACTUAL_POSTING_DATE, B.PLAN_DELIVERY_DATE,
	A.RETURN_REASON_CODE,A.RETURN_REASON_NAME,
	A.QUANTITY, A.QUANTITY_BASE,A.ORIGINAL_QUANTITY_BASE, A.UNIT_PRICE, A.LINE_DISCOUNT_AMOUNT, A.AMOUNT, A.AMOUNT_VALUES,
	(CASE WHEN A.FREE_ITEM = 0 THEN 'SALES ITEM'
		WHEN A.FREE_ITEM = 1 THEN 'PROMOTION ITEM'
		WHEN A.FREE_ITEM = 2 THEN 'DISPLAY ITEM' ELSE 'LOYALTY ITEM' END) AS ITEM_TYPE
FROM STG.NAV_SALES_CR_MEMO_LINE A
	LEFT JOIN STG.NAV_SALES_CR_MEMO_HEADER B
	ON A.DOCUMENT_NO = B.NO AND A.DISTRIBUTOR = B.DISTRIBUTOR
	LEFT JOIN DWH.D_DISTRIBUTOR C
	ON A.DISTRIBUTOR = C.DISTRIBUTOR_CODE AND A.LOCATION_CODE = C.LOCATION_CODE AND A.BIN_CODE = C.BIN_CODE
	LEFT JOIN DWH.D_CUSTOMER D
	ON A.SELL_TO_CUSTOMER_NO = D.CUSTOMER_CODE
	LEFT JOIN DWH.D_EMPLOYEE E
	ON B.SALESPERSON_CODE = E.EMPLOYEE_CODE
	LEFT JOIN DWH.D_SALES_FORCE F
	ON B.SALES_ROUTE_CODE = F.SALES_ROUTE_CODE
	LEFT JOIN DWH.D_PRODUCT G
	ON A.NO = G.PRODUCT_CODE AND A.UNIT_OF_MEASURE_CODE = G.UOM_CODE
2. SALES_RETURN~DISTRIBUTOR~DOCUMENT_NO~LINE_NO~NO~UNIT_OF_MEASURE_CODE~ITEM_TYPE AS W_INTEGRATION_ID"
53,",DEFAULT = 'NAV_SALES_CR_MEMO_LINE' AS W_SOURCE"
54,",C.DISTRIBUTOR_KEY AS DISTRIBUTOR_KEY"
55,",D.CUSTOMER_KEY AS CUSTOMER_KEY"
56,",E.EMPLOYEE_KEY AS EMPLOYEE_KEY"
57,",F.SALES_FORCE_KEY AS SALES_FORCE_KEY"
58,",G.PRODUCT_KEY AS PRODUCT_KEY"
59,",POSTING_DATE AS DATE_KEY"
60,",POSTING_DATE AS YEAR"
61,",POSTING_DATE AS MONTH"
62,",DEFAULT = 'SALES_RETURN' AS TRANSACTION_TYPE"
63,",A.DOCUMENT_NO AS SALES_HEADER_CODE"
64,",A.LINE_NO AS SALES_LINE_CODE"
65,",B.RETURN_ORDER_NO AS RETURN_ORDER_CODE"
66,",B.ORDER_NO AS ORDER_CODE"
67,",B.EXTERNAL_DOCUMENT_NO AS EXTERNAL_DOCUMENT_CODE"
68,",RETURN_TYPE AS RETURN_TYPE"
69,",ORDER_TYPE AS ORDER_TYPE"
70,",IF B.OFF_ROUTE = 0 THEN 'N' ELSE 'Y' AS OFF_ROUTE_FLAG"
71,",IF B.FROM_EMOBIZ = 0 THEN 'N' ELSE 'Y' AS FROM_EMOBIZ_FLAG"
72,",B.ORDER_DATE AS ORDER_DATE"
73,",B.POSTING_DATE AS POSTING_DATE"
74,",B.ACTUAL_POSTING_DATE AS ACTUAL_POSTING_DATE"
75,",B.DOCUMENT_DATE AS DOCUMENT_DATE"
76,",B.PLAN_DELIVERY_DATE AS PLAN_DELIVEY_DATE"
77,",A.SHIPMENT_DATE AS ACTUAL_DELIVEY_DATE"
78,",A.RETURN_REASON_CODE AS RETURN_REASON_CODE"
79,",A.RETURN_REASON_NAME AS RETURN_REASON_NAME"
80,",ITEM_TYPE AS ITEM_TYPE"
81,",A.QUANTITY AS QUANTITY"
82,",A.QUANTITY_BASE AS QUANTITY_BASE"
83,",A.ORIGINAL_QUANTITY_BASE AS ORIGINAL_QUANTITY_BASE"
84,",A.UNIT_PRICE AS UNIT_PRICE"
85,",= A.UNIT_PRICE * A.QUANTITY AS AMOUNT"
86,",A.LINE_DISCOUNT_AMOUNT AS DISCOUNT_AMOUNT"
87,",A.AMOUNT AS AMOUNT_AFTER_DISCOUNT"
88,",A.AMOUNT_VALUES AS PROMOTION_VALUE_AMOUNT"
89,",W_INSERT_DT"
90,",W_UPDATE_DT"
91,",1. WITH STOCK_OUT AS	(SELECT DISTINCT A.DOCUMENT_NO, A.STOCK_OUT_NO, A.DISTRIBUTOR FROM STG.NAV_STOCK_OUT_LINE A
					LEFT JOIN STG.NAV_STOCK_OUT_HEADER B
					ON A.STOCK_OUT_NO = B.NO
					WHERE B.STATUS NOT IN (0,2))
SELECT C.DISTRIBUTOR_KEY, D.CUSTOMER_KEY, E.EMPLOYEE_KEY, F.SALES_FORCE_KEY, G.PRODUCT_KEY,
	A.DOCUMENT_NO, A.LINE_NO, B.EXTERNAL_DOCUMENT_NO, B.OFF_ROUTE, B.FROM_EMOBIZ,
	(CASE WHEN B.SALES_TYPE = 0 THEN 'VANSALES' 
		WHEN B.SALES_TYPE = 1 THEN 'PRESALES' 
		WHEN B.SALES_TYPE = 2 THEN 'PRESALESWITHPARTIALSHIP' ELSE 'SAMPLING' END) AS ORDER_TYPE,
	B.ORDER_DATE, B.POSTING_DATE, B.DOCUMENT_DATE,A.SHIPMENT_DATE, A.PLANNED_DELIVERY_DATE,
	A.QUANTITY, A.QUANTITY_BASE,A.ORIGINAL_QUANTITY_BASE, A.QUANTITY_SHIPPED, A.QTY_SHIPPED_BASE, 
	A.UNIT_PRICE, A.LINE_DISCOUNT_AMOUNT, A.AMOUNT, A.AMOUNT_VALUES,
	(CASE WHEN A.FREE_ITEM = 0 THEN 'SALES ITEM'
		WHEN A.FREE_ITEM = 1 THEN 'PROMOTION ITEM'
		WHEN A.FREE_ITEM = 2 THEN 'DISPLAY ITEM' ELSE 'LOYALTY ITEM' END) AS ITEM_TYPE,
	(CASE WHEN B1.STOCK_OUT_NO IS NULL THEN 'N' ELSE 'Y' END) AS STOCK_OUT_FLAG
FROM STG.NAV_SALES_LINE A
	LEFT JOIN STG.NAV_SALES_HEADER B
	ON A.DOCUMENT_NO = B.NO AND A.DISTRIBUTOR = B.DISTRIBUTOR
	LEFT JOIN STOCK_OUT B1
	ON B.NO = B1.DOCUMENT_NO AND B.DISTRIBUTOR = B1.DISTRIBUTOR
	LEFT JOIN DWH.D_DISTRIBUTOR C
	ON A.DISTRIBUTOR = C.DISTRIBUTOR_CODE AND A.LOCATION_CODE = C.LOCATION_CODE AND A.BIN_CODE = C.BIN_CODE
	LEFT JOIN DWH.D_CUSTOMER D
	ON A.SELL_TO_CUSTOMER_NO = D.CUSTOMER_CODE
	LEFT JOIN DWH.D_EMPLOYEE E
	ON B.SALESPERSON_CODE = E.EMPLOYEE_CODE
	LEFT JOIN DWH.D_SALES_FORCE F
	ON B.SALES_ROUTE_CODE = F.SALES_ROUTE_CODE
	LEFT JOIN DWH.D_PRODUCT G
	ON A.NO = G.PRODUCT_CODE AND A.UNIT_OF_MEASURE_CODE = G.UOM_CODE
2. SALES_ORDER~DISTRIBUTOR~DOCUMENT_NO~LINE_NO~NO~UNIT_OF_MEASURE_CODE~ITEM_TYPE AS W_INTEGRATION_ID"
92,",DEFAULT = 'NAV_SALES_LINE' AS W_SOURCE"
93,",C.DISTRIBUTOR_KEY AS DISTRIBUTOR_KEY"
94,",D.CUSTOMER_KEY AS CUSTOMER_KEY"
95,",E.EMPLOYEE_KEY AS EMPLOYEE_KEY"
96,",F.SALES_FORCE_KEY AS SALES_FORCE_KEY"
97,",G.PRODUCT_KEY AS PRODUCT_KEY"
98,",POSTING_DATE AS DATE_KEY"
99,",POSTING_DATE AS YEAR"
100,",POSTING_DATE AS MONTH"
101,",DEFAULT = 'SALES_ORDER' AS TRANSACTION_TYPE"
102,",A.DOCUMENT_NO AS SALES_HEADER_CODE"
103,",A.LINE_NO AS SALES_LINE_CODE"
104,",B.EXTERNAL_DOCUMENT_NO AS EXTERNAL_DOCUMENT_CODE"
105,",ORDER_TYPE AS ORDER_TYPE"
106,",IF B.OFF_ROUTE = 0 THEN 'N' ELSE 'Y' AS OFF_ROUTE_FLAG"
107,",IF B.FROM_EMOBIZ = 0 THEN 'N' ELSE 'Y' AS FROM_EMOBIZ_FLAG"
108,",STOCK_OUT_FLAG AS STOCK_OUT_FLAG"
109,",DEFAULT = '' AS PROSPECT_CUSTOMER_NAME"
110,",DEFAULT = '' AS PROSPECT_CUSTOMER_ADDRESS"
111,",DEFAULT = '' AS PROSPECT_CUSTOMER_PHONE"
112,",B.ORDER_DATE AS ORDER_DATE"
113,",B.POSTING_DATE AS POSTING_DATE"
114,",B.DOCUMENT_DATE AS DOCUMENT_DATE"
115,",A.PLAN_DELIVERY_DATE AS PLAN_DELIVEY_DATE"
116,",A.SHIPMENT_DATE AS ACTUAL_DELIVEY_DATE"
117,",ITEM_TYPE AS ITEM_TYPE"
118,",A.QUANTITY AS QUANTITY"
119,",A.QUANTITY_BASE AS QUANTITY_BASE"
120,",A.ORIGINAL_QUANTITY_BASE AS ORIGINAL_QUANTITY_BASE"
121,",A.QUANTITY_SHIPPED AS QUANTITY_SHIPPED"
122,",A.QTY_SHIPPED_BASE AS QUANTITY_SHIPPED_BASE"
123,",A.UNIT_PRICE AS UNIT_PRICE"
124,",= A.UNIT_PRICE * A.QUANTITY AS AMOUNT"
125,",A.LINE_DISCOUNT_AMOUNT AS DISCOUNT_AMOUNT"
126,",A.AMOUNT AS AMOUNT_AFTER_DISCOUNT"
127,",A.AMOUNT_VALUES AS PROMOTION_VALUE_AMOUNT"
128,",1. WITH SALES_ORDER AS	(SELECT SALESORDERCODE, CUSTOMERCODE AS DISTRIBUTOR 
					FROM STG.EMB_SALESORDERREJECTHEADER
					WHERE CANCELED = 1 OR DELETED = 1
					UNION
					SELECT DISTINCT ORDER_NO AS SALESORDERCODE, DISTRIBUTOR 
					FROM STG.NAV_SALES_INVOICE_HEADER 
					WHERE FROM_EMOBIZ = 1
					UNION
					SELECT DISTINCT NO AS SALESORDERCODE, DISTRIBUTOR 
					FROM STG.NAV_SALES_HEADER 
					WHERE FROM_EMOBIZ = 1)
SELECT
C.DISTRIBUTOR_KEY, D.CUSTOMER_KEY, E.EMPLOYEE_KEY, F.SALES_FORCE_KEY, G.PRODUCT_KEY,
	A.SALESORDERCODE, A.SALESORDERDETAILLINEID, B.OFFROUTE,
	(CASE WHEN B.ORDERTYPE = 0 THEN 'VANSALES' 
		WHEN B.ORDERTYPE = 1 THEN 'PRESALES' 
		WHEN B.ORDERTYPE = 2 THEN 'PRESALESWITHPARTIALSHIP' ELSE 'SAMPLING' END) AS ORDER_TYPE,
	B.ORDERDATE, B.PLANDELIVERYDATE, A.QUANTITY, A.UOMQUANTITY, A.UNITPRICE, A.ORDERDISCOUNT, A.GSV, A.NIV,
	(CASE WHEN A.FREEITEMTYPE = 'S' THEN 'SALES ITEM' ELSE 'PROMOTION ITEM' END) AS ITEM_TYPE,
	H.FREEITEMVALUE, D1.SECONDARYCUSTOMERNAME, TRIM(CONCAT(REPLACE(D1.ADDRESS,'-',''), ' ',D1.ADDRESS2)) AS ADDRESS, D1.PHONE2
FROM STG.EMB_SALESORDERDETAIL A
	LEFT JOIN STG.EMB_SALESORDERHEADER B
	ON A.SALESORDERCODE = B.SALESORDERCODE AND A.CUSTOMERCODE = B.CUSTOMERCODE AND B.DELETED = 'FALSE'
	LEFT JOIN STG.EMB_SALESROUTEWAREHOUSE C1
	ON B.SALESROUTECODE = C1.SALESROUTECODE AND B.CUSTOMERCODE = C1.CUSTOMERCODE AND C1.DELETED = 0
	LEFT JOIN DWH.D_DISTRIBUTOR C
	ON B.CUSTOMERCODE = C.DISTRIBUTOR_CODE AND C1.WAREHOUSECODE = C.LOCATION_CODE AND C.BIN_TYPE = 'MAIN_BIN'
	LEFT JOIN STG.EMB_PROSPECTSECONDARYCUSTOMER D1
	ON B.SECONDARYCUSTOMERCODE = D1.SECONDARYCUSTOMERCODE AND B.CUSTOMERCODE = D1.CUSTOMERCODE
	LEFT JOIN DWH.D_CUSTOMER D
	ON B.SECONDARYCUSTOMERCODE = D.CUSTOMER_CODE
	LEFT JOIN DWH.D_EMPLOYEE E
	ON B.SALESPERSONCODE = E.EMPLOYEE_CODE
	LEFT JOIN DWH.D_SALES_FORCE F
	ON B.SALESROUTECODE = F.SALES_ROUTE_CODE
	LEFT JOIN DWH.D_PRODUCT G
	ON A.PRODUCTCODE = G.PRODUCT_CODE AND A.UOMCODE = G.UOM_CODE
	LEFT JOIN STG.EMB_PROMOTIONRESULT H
	ON A.CUSTOMERCODE = H.CUSTOMERCODE AND A.SALESORDERCODE = H.SALESORDERCODE AND H.DELETED = 0
	AND A.SALESORDERDETAILLINEID = H.SALESORDERDETAILLINEID AND ISNULL(H.PRODUCTCODE,'') <> ''
WHERE A.DELETED = 'FALSE'
AND NOT EXISTS (SELECT * FROM SALES_ORDER	B
					WHERE A.CUSTOMERCODE = B.DISTRIBUTOR AND A.SALESORDERCODE = B.SALESORDERCODE)
2. SALES_ORDER~DISTRIBUTOR~SALESORDERCODE~SALESORDERDETAILLINEID~PRODUCTCODE~UOMCODE~FREEITEMTYPE AS W_INTEGRATION_ID"
129,",DEFAULT = 'EMB_SALESORDERDETAIL' AS W_SOURCE"
130,",C.DISTRIBUTOR_KEY AS DISTRIBUTOR_KEY"
131,",D.CUSTOMER_KEY AS CUSTOMER_KEY"
132,",E.EMPLOYEE_KEY AS EMPLOYEE_KEY"
133,",F.SALES_FORCE_KEY AS SALES_FORCE_KEY"
134,",G.PRODUCT_KEY AS PRODUCT_KEY"
135,",ORDERDATE AS DATE_KEY"
136,",ORDERDATE AS YEAR"
137,",ORDERDATE AS MONTH"
138,",DEFAULT = 'SALES_ORDER' AS TRANSACTION_TYPE"
139,",A.SALESORDERCODE AS SALES_HEADER_CODE"
140,",A.SALESORDERDETAILLINEID AS SALES_LINE_CODE"
141,",A.SALESORDERCODE AS EXTERNAL_DOCUMENT_CODE"
142,",ORDER_TYPE AS ORDER_TYPE"
143,",IF B.OFF_ROUTE = 0 THEN 'N' ELSE 'Y' AS OFF_ROUTE_FLAG"
144,",DEFAULT = 'Y' AS FROM_EMOBIZ_FLAG"
145,",DEFAULT = 'N' AS STOCK_OUT_FLAG"
146,",D1.SECONDARYCUSTOMERNAME AS PROSPECT_CUSTOMER_NAME"
147,",ADDRESS AS PROSPECT_CUSTOMER_ADDRESS"
148,",D1.PHONE2 AS PROSPECT_CUSTOMER_PHONE"
149,",B.ORDERDATE AS ORDER_DATE"
150,",B.ORDERDATE AS POSTING_DATE"
151,",B.ORDERDATE AS DOCUMENT_DATE"
152,",B.PLANDELIVERYDATE AS PLAN_DELIVEY_DATE"
153,",B.PLANDELIVERYDATE AS ACTUAL_DELIVEY_DATE"
154,",ITEM_TYPE AS ITEM_TYPE"
155,",A.QUANTITY AS QUANTITY"
156,",A.QUANTITY * A.UOMQUANTITY AS QUANTITY_BASE"
157,",A.QUANTITY * A.UOMQUANTITY AS ORIGINAL_QUANTITY_BASE"
158,",DEFAULT = 0 AS QUANTITY_SHIPPED"
159,",DEFAULT = 0 AS QUANTITY_SHIPPED_BASE"
160,",A.UNITPRICE AS UNIT_PRICE"
161,",A.GSV AS AMOUNT"
162,",A.ORDERDISCOUNT AS DISCOUNT_AMOUNT"
163,",A.NIV AS AMOUNT_AFTER_DISCOUNT"
164,",H.FREEITEMVALUE AS PROMOTION_VALUE_AMOUNT"
165,",W_INSERT_DT"
166,",W_UPDATE_DT"
167,",1. LẤY F_SALES_INVOICE_DETAIL - F_SALES_RETURN_DETAIL
GROUP BY THEO DISTRIBUTOR_KEY, CUSTOMER_KEY, EMPLOYEE_KEY, SALES_FORCE_KEY, PRODUCT_KEY, DATE_KEY, ITEM_TYPE
2. DISTRIBUTOR_KEY~CUSTOMER_KEY~EMPLOYEE_KEY~SALES_FORCE_KEY~PRODUCT_KEY~DATE_KEY~ITEM_TYPE AS W_INTEGRATION_ID"
168,",DEFAULT = 'SALES_INVOICE_DAILY' AS W_SOURCE"
169,",DISTRIBUTOR_KEY AS DISTRIBUTOR_KEY"
170,",CUSTOMER_KEY AS CUSTOMER_KEY"
171,",EMPLOYEE_KEY AS EMPLOYEE_KEY"
172,",SALES_FORCE_KEY AS SALES_FORCE_KEY"
173,",PRODUCT_KEY AS PRODUCT_KEY"
174,",DATE_KEY AS DATE_KEY"
175,",YEAR AS YEAR"
176,",MONTH AS MONTH"
177,",ITEM_TYPE AS ITEM_TYPE"
178,",ƯU TIÊN LẤY Ở SALE_INVOICE --> NẾU KHÔNG CÓ Ở SALES_INVOICE MÀ CÓ Ở RETURN THÌ LẤY THEO RETURN AS OFF_ROUTE_FLAG"
179,",QUANTITY AS QUANTITY"
180,",QUANTITY_BASE AS QUANTITY_BASE"
181,",AMOUNT AS AMOUNT"
182,",DISCOUNT_AMOUNT AS DISCOUNT_AMOUNT"
183,",AMOUNT_AFTER_DISCOUNT AS AMOUNT_AFTER_DISCOUNT"
184,",PROMOTION_VALUE_AMOUNT AS PROMOTION_VALUE_AMOUNT"
185,",W_INSERT_DT"
186,",W_UPDATE_DT"
187,",1. LẤY F_SALES_INVOICE_DETAIL + F_SALES_ORDER_DETAIL - F_SALES_RETURN_DETAIL
GROUP BY THEO DISTRIBUTOR_KEY, CUSTOMER_KEY, EMPLOYEE_KEY, SALES_FORCE_KEY, PRODUCT_KEY, DATE_KEY, ITEM_TYPE
2. DISTRIBUTOR_KEY~CUSTOMER_KEY~EMPLOYEE_KEY~SALES_FORCE_KEY~PRODUCT_KEY~DATE_KEY~ITEM_TYPE AS W_INTEGRATION_ID"
188,",DEFAULT = 'SALES_INVOICE_SALES_ORDER_DAILY' AS W_SOURCE"
189,",DISTRIBUTOR_KEY AS DISTRIBUTOR_KEY"
190,",CUSTOMER_KEY AS CUSTOMER_KEY"
191,",EMPLOYEE_KEY AS EMPLOYEE_KEY"
192,",SALES_FORCE_KEY AS SALES_FORCE_KEY"
193,",PRODUCT_KEY AS PRODUCT_KEY"
194,",DATE_KEY AS DATE_KEY"
195,",YEAR AS YEAR"
196,",MONTH AS MONTH"
197,",ITEM_TYPE AS ITEM_TYPE"
198,",ƯU TIÊN LẤY Ở SALE_INVOICE, SALES_ORDER --> NẾU KHÔNG CÓ Ở SALES_INVOICE MÀ CÓ Ở RETURN THÌ LẤY THEO RETURN AS OFF_ROUTE_FLAG"
199,",QUANTITY AS QUANTITY"
200,",QUANTITY_BASE AS QUANTITY_BASE"
201,",AMOUNT AS AMOUNT"
202,",DISCOUNT_AMOUNT AS DISCOUNT_AMOUNT"
203,",AMOUNT_AFTER_DISCOUNT AS AMOUNT_AFTER_DISCOUNT"
204,",PROMOTION_VALUE_AMOUNT AS PROMOTION_VALUE_AMOUNT"
205,",W_INSERT_DT"
206,",W_UPDATE_DT"
207,",1. LẤY F_SALES_INVOICE_DAILY
GROUP BY THEO DISTRIBUTOR_KEY, CUSTOMER_KEY, EMPLOYEE_KEY, SALES_FORCE_KEY, PRODUCT_KEY, ITEM_TYPE, YEAR, MONTH
2. DISTRIBUTOR_KEY~CUSTOMER_KEY~EMPLOYEE_KEY~SALES_FORCE_KEY~PRODUCT_KEY~ITEM_TYPE~YEAR~MONTH AS W_INTEGRATION_ID"
208,",DEFAULT = 'SALES_INVOICE_MONTHLY' AS W_SOURCE"
209,",DISTRIBUTOR_KEY AS DISTRIBUTOR_KEY"
210,",CUSTOMER_KEY AS CUSTOMER_KEY"
211,",EMPLOYEE_KEY AS EMPLOYEE_KEY"
212,",SALES_FORCE_KEY AS SALES_FORCE_KEY"
213,",PRODUCT_KEY AS PRODUCT_KEY"
214,",DATE_KEY --> LẤY NGÀY ĐẦU THÁNG AS DATE_KEY"
215,",YEAR AS YEAR"
216,",MONTH AS MONTH"
217,",ITEM_TYPE AS ITEM_TYPE"
218,",QUANTITY AS QUANTITY"
219,",QUANTITY_BASE AS QUANTITY_BASE"
220,",AMOUNT AS AMOUNT"
221,",DISCOUNT_AMOUNT AS DISCOUNT_AMOUNT"
222,",AMOUNT_AFTER_DISCOUNT AS AMOUNT_AFTER_DISCOUNT"
223,",PROMOTION_VALUE_AMOUNT AS PROMOTION_VALUE_AMOUNT"
224,",W_INSERT_DT"
225,",W_UPDATE_DT"
226,",1. LẤY F_SALES_INVOICE_ORDER_DAILY
GROUP BY THEO DISTRIBUTOR_KEY, CUSTOMER_KEY, EMPLOYEE_KEY, SALES_FORCE_KEY, PRODUCT_KEY, ITEM_TYPE, YEAR, MONTH
2. DISTRIBUTOR_KEY~CUSTOMER_KEY~EMPLOYEE_KEY~SALES_FORCE_KEY~PRODUCT_KEY~ITEM_TYPE~YEAR~MONTH AS W_INTEGRATION_ID"
227,",DEFAULT = 'SALES_INVOICE_SALES_ORDER_MONTHLY' AS W_SOURCE"
228,",DISTRIBUTOR_KEY AS DISTRIBUTOR_KEY"
229,",CUSTOMER_KEY AS CUSTOMER_KEY"
230,",EMPLOYEE_KEY AS EMPLOYEE_KEY"
231,",SALES_FORCE_KEY AS SALES_FORCE_KEY"
232,",PRODUCT_KEY AS PRODUCT_KEY"
233,",DATE_KEY --> LẤY NGÀY ĐẦU THÁNG AS DATE_KEY"
234,",YEAR AS YEAR"
235,",MONTH AS MONTH"
236,",ITEM_TYPE AS ITEM_TYPE"
237,",QUANTITY AS QUANTITY"
238,",QUANTITY_BASE AS QUANTITY_BASE"
239,",AMOUNT AS AMOUNT"
240,",DISCOUNT_AMOUNT AS DISCOUNT_AMOUNT"
241,",AMOUNT_AFTER_DISCOUNT AS AMOUNT_AFTER_DISCOUNT"
242,",PROMOTION_VALUE_AMOUNT AS PROMOTION_VALUE_AMOUNT"
