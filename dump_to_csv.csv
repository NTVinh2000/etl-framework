test_function
"CREATE OR ALTER VIEW DWH.V_F_SALES_INVOICE_DAILY AS
WITH CTE AS (
1. LẤY F_SALES_INVOICE_DETAIL - F_SALES_RETURN_DETAIL
GROUP BY THEO DISTRIBUTOR_KEY, CUSTOMER_KEY, EMPLOYEE_KEY, SALES_FORCE_KEY, PRODUCT_KEY, DATE_KEY, ITEM_TYPE
2. DISTRIBUTOR_KEY~CUSTOMER_KEY~EMPLOYEE_KEY~SALES_FORCE_KEY~PRODUCT_KEY~DATE_KEY~ITEM_TYPE AS W_INTEGRATION_ID
)
SELECT"
",DATE_KEY AS DATE_KEY"
",DISCOUNT_AMOUNT AS DISCOUNT_AMOUNT"
",AMOUNT AS AMOUNT"
",QUANTITY_BASE AS QUANTITY_BASE"
",QUANTITY AS QUANTITY"
",ƯU TIÊN LẤY Ở SALE_INVOICE --> NẾU KHÔNG CÓ Ở SALES_INVOICE MÀ CÓ Ở RETURN THÌ LẤY THEO RETURN AS OFF_ROUTE_FLAG"
",ITEM_TYPE AS ITEM_TYPE"
",MONTH AS MONTH"
",YEAR AS YEAR"
",PROMOTION_VALUE_AMOUNT AS PROMOTION_VALUE_AMOUNT"
",ISNULL(PRODUCT_KEY,-1) AS PRODUCT_KEY"
",ISNULL(SALES_FORCE_KEY,-1) AS SALES_FORCE_KEY"
",ISNULL(EMPLOYEE_KEY,-1) AS EMPLOYEE_KEY"
",ISNULL(CUSTOMER_KEY,-1) AS CUSTOMER_KEY"
",ISNULL(DISTRIBUTOR_KEY,-1) AS DISTRIBUTOR_KEY"
",AMOUNT_AFTER_DISCOUNT AS AMOUNT_AFTER_DISCOUNT"
",'SALES_INVOICE_DAILY' AS W_SOURCE"
",W_INSERT_DT"
",W_UPDATE_DT"
